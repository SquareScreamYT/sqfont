char_dict = {
  " ": [
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
  ],
  "!": [
    ".",
    ".",
    ".",
    ".",
    ".",
    " ",
    ".",
    " ",
    " ",
  ],
  "\"": [
    ". .",
    ". .",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
  ],
  "#": [
    " . . ",
    " . . ",
    ".....",
    " . . ",
    ".....",
    " . . ",
    " . . ",
    "     ",
    "     ",
  ],
  "$": [
    "  .  ",
    " ....",
    ". .  ",
    " ... ",
    "  . .",
    ".... ",
    "  .  ",
    "     ",
    "     ",
  ],
  "%": [
    ".   .",
    ".  . ",
    "   . ",
    "  .  ",
    " .   ",
    " .  .",
    ".   .",
    "     ",
    "     ",
  ],
  "&": [
    " ..  ",
    ".  . ",
    ". .  ",
    " .   ",
    ". . .",
    ".  . ",
    " .. .",
    "     ",
    "     ",
  ],
  "'": [
    ".",
    ".",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
  ],
  "(": [
    "  .",
    " . ",
    ".  ",
    ".  ",
    ".  ",
    " . ",
    "  .",
    "   ",
    "   ",
  ],
  ")": [
    ".  ",
    " . ",
    "  .",
    "  .",
    "  .",
    " . ",
    ".  ",
    "   ",
    "   ",
  ],
  "*": [
    ". .",
    " . ",
    ". .",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
    "   ",
  ],
  "+": [
    "     ",
    "  .  ",
    "  .  ",
    ".....",
    "  .  ",
    "  .  ",
    "     ",
    "     ",
    "     ",
  ],
  ",": [
    "  ",
    "  ",
    "  ",
    "  ",
    "  ",
    "  ",
    " .",
    ". ",
    "  ",
  ],
  "-": [
    "     ",
    "     ",
    "     ",
    ".....",
    "     ",
    "     ",
    "     ",
    "     ",
    "     ",
  ],
  ".": [
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    ".",
    " ",
    " ",
  ],
  "/": [
    "    .",
    "   . ",
    "   . ",
    "  .  ",
    " .   ",
    " .   ",
    ".    ",
    "     ",
    "     ",
  ],
  "0": [
    " ... ",
    ".   .",
    ".  ..",
    ". . .",
    "..  .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "1": [
    "  .  ",
    " ..  ",
    ". .  ",
    "  .  ",
    "  .  ",
    "  .  ",
    ".....",
    "     ",
    "     ",
  ],
  "2": [
    " ... ",
    ".   .",
    "    .",
    "   . ",
    "  .  ",
    " .   ",
    ".....",
    "     ",
    "     ",
  ],
  "3": [
    " ... ",
    ".   .",
    "    .",
    "  .. ",
    "    .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "4": [
    "   . ",
    "  .. ",
    " . . ",
    ".  . ",
    ".....",
    "   . ",
    "   . ",
    "     ",
    "     ",
  ],
  "5": [
    ".....",
    ".    ",
    ".    ",
    ".... ",
    "    .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "6": [
    " ... ",
    ".   .",
    ".    ",
    ".... ",
    ".   .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "7": [
    ".....",
    "    .",
    "    .",
    "   . ",
    "  .  ",
    "  .  ",
    "  .  ",
    "     ",
    "     ",
  ],
  "8": [
    " ... ",
    ".   .",
    ".   .",
    " ... ",
    ".   .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "9": [
    " ... ",
    ".   .",
    ".   .",
    " ....",
    "    .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  ":": [
    " ",
    " ",
    ".",
    " ",
    " ",
    " ",
    ".",
    " ",
    " ",
  ],
  ";": [
    "  ",
    "  ",
    " .",
    "  ",
    "  ",
    "  ",
    " .",
    ". ",
    "  ",
  ],
  "<": [
    "   ",
    "  .",
    " . ",
    ".  ",
    " . ",
    "  .",
    "   ",
    "   ",
    "   ",
  ],
  "=": [
    "     ",
    "     ",
    ".....",
    "     ",
    ".....",
    "     ",
    "     ",
    "     ",
    "     ",
  ],
  ">": [
    "   ",
    ".  ",
    " . ",
    "  .",
    " . ",
    ".  ",
    "   ",
    "   ",
    "   ",
  ],
  "?": [
    " ... ",
    ".   .",
    "    .",
    "   . ",
    "  .  ",
    "     ",
    "  .  ",
    "     ",
    "     ",
  ],
  "@": [
    " ... ",
    ".   .",
    ".  ..",
    ". . .",
    ".  ..",
    ".    ",
    " ....",
    "     ",
    "     ",
  ],
  "A": [
    " ... ",
    ".   .",
    ".   .",
    ".....",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "B": [
    ".... ",
    ".   .",
    ".   .",
    ".... ",
    ".   .",
    ".   .",
    ".... ",
    "     ",
    "     ",
  ],
  "C": [
    " ... ",
    ".   .",
    ".    ",
    ".    ",
    ".    ",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "D": [
    ".... ",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    ".... ",
    "     ",
    "     ",
  ],
  "E": [
    ".....",
    ".    ",
    ".    ",
    ".... ",
    ".    ",
    ".    ",
    ".....",
    "     ",
    "     ",
  ],
  "F": [
    ".....",
    ".    ",
    ".    ",
    ".... ",
    ".    ",
    ".    ",
    ".    ",
    "     ",
    "     ",
  ],
  "G": [
    " ... ",
    ".   .",
    ".    ",
    ".  ..",
    ".   .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "H": [
    ".   .",
    ".   .",
    ".   .",
    ".....",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "I": [
    "...",
    " . ",
    " . ",
    " . ",
    " . ",
    " . ",
    "...",
    "   ",
    "   ",
  ],
  "J": [
    "  ...",
    "   . ",
    "   . ",
    "   . ",
    "   . ",
    ".  . ",
    " ..  ",
    "     ",
    "     ",
  ],
  "K": [
    ".   .",
    ".  . ",
    ". .  ",
    "..   ",
    ". .  ",
    ".  . ",
    ".   .",
    "     ",
    "     ",
  ],
  "L": [
    ".    ",
    ".    ",
    ".    ",
    ".    ",
    ".    ",
    ".    ",
    ".....",
    "     ",
    "     ",
  ],
  "M": [
    ".   .",
    ".. ..",
    ". . .",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "N": [
    ".   .",
    "..  .",
    ". . .",
    ".  ..",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "O": [
    " ... ",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "P": [
    ".... ",
    ".   .",
    ".   .",
    ".... ",
    ".    ",
    ".    ",
    ".    ",
    "     ",
    "     ",
  ],
  "Q": [
    " ... ",
    ".   .",
    ".   .",
    ".   .",
    ". . .",
    ".  . ",
    " .. .",
    "     ",
    "     ",
  ],
  "R": [
    ".... ",
    ".   .",
    ".   .",
    ".... ",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "S": [
    " ... ",
    ".   .",
    ".    ",
    " ... ",
    "    .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "T": [
    ".....",
    "  .  ",
    "  .  ",
    "  .  ",
    "  .  ",
    "  .  ",
    "  .  ",
    "     ",
    "     ",
  ],
  "U": [
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "V": [
    ".   .",
    ".   .",
    ".   .",
    " . . ",
    " . . ",
    " . . ",
    "  .  ",
    "     ",
    "     ",
  ],
  "W": [
    ".   .",
    ".   .",
    ".   .",
    ". . .",
    ". . .",
    " . . ",
    " . . ",
    "     ",
    "     ",
  ],
  "X": [
    ".   .",
    ".   .",
    " . . ",
    "  .  ",
    " . . ",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "Y": [
    ".   .",
    ".   .",
    " . . ",
    "  .  ",
    "  .  ",
    "  .  ",
    "  .  ",
    "     ",
    "     ",
  ],
  "Z": [
    ".....",
    "    .",
    "   . ",
    "  .  ",
    " .   ",
    ".    ",
    ".....",
    "     ",
    "     ",
  ],
  "[": [
    "...",
    ".  ",
    ".  ",
    ".  ",
    ".  ",
    ".  ",
    "...",
    "   ",
    "   ",
  ],
  "\\": [
    ".    ",
    " .   ",
    " .   ",
    "  .  ",
    "   . ",
    "   . ",
    "    .",
    "     ",
    "     ",
  ],
  "]": [
    "...",
    "  .",
    "  .",
    "  .",
    "  .",
    "  .",
    "...",
    "   ",
    "   ",
  ],
  "^": [
    "  .  ",
    " . . ",
    ".   .",
    "     ",
    "     ",
    "     ",
    "     ",
    "     ",
    "     ",
  ],
  "_": [
    "     ",
    "     ",
    "     ",
    "     ",
    "     ",
    "     ",
    ".....",
    "     ",
    "     ",
  ],
  "`": [
    ". ",
    " .",
    "  ",
    "  ",
    "  ",
    "  ",
    "  ",
    "  ",
    "  ",
  ],
  "a": [
    "     ",
    "     ",
    ".... ",
    "    .",
    " ....",
    ".   .",
    " ....",
    "     ",
    "     ",
  ],
  "b": [
    ".    ",
    ".    ",
    ". .. ",
    "..  .",
    ".   .",
    ".   .",
    ".... ",
    "     ",
    "     ",
  ],
  "c": [
    "     ",
    "     ",
    " ... ",
    ".   .",
    ".    ",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "d": [
    "    .",
    "    .",
    " .. .",
    ".  ..",
    ".   .",
    ".   .",
    " ....",
    "     ",
    "     ",
  ],
  "e": [
    "     ",
    "     ",
    " ... ",
    ".   .",
    ".....",
    ".    ",
    " ....",
    "     ",
    "     ",
  ],
  "f": [
    "  .. ",
    " .  .",
    " .   ",
    "...  ",
    " .   ",
    " .   ",
    " .   ",
    "     ",
    "     ",
  ],
  "g": [
    "     ",
    "     ",
    " ....",
    ".   .",
    ".   .",
    ".  ..",
    " .. .",
    "    .",
    ".... ",
  ],
  "h": [
    ".    ",
    ".    ",
    ". .. ",
    "..  .",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "i": [
    ".",
    " ",
    ".",
    ".",
    ".",
    ".",
    ".",
    " ",
    " ",
  ],
  "j": [
    "   .",
    "    ",
    "   .",
    "   .",
    "   .",
    "   .",
    "   .",
    ".  .",
    " .. ",
  ],
  "k": [
    ".   ",
    ".   ",
    ".  .",
    ". . ",
    "..  ",
    ". . ",
    ".  .",
    "    ",
    "    ",
  ],
  "l": [
    ".",
    ".",
    ".",
    ".",
    ".",
    ".",
    ".",
    " ",
    " ",
  ],
  "m": [
    "     ",
    "     ",
    ".... ",
    ". . .",
    ". . .",
    ". . .",
    ". . .",
    "     ",
    "     ",
  ],
  "n": [
    "     ",
    "     ",
    ".... ",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    "     ",
    "     ",
  ],
  "o": [
    "     ",
    "     ",
    " ... ",
    ".   .",
    ".   .",
    ".   .",
    " ... ",
    "     ",
    "     ",
  ],
  "p": [
    "     ",
    "     ",
    ". .. ",
    "..  .",
    ".   .",
    ".   .",
    ".... ",
    ".    ",
    ".    ",
  ],
  "q": [
    "     ",
    "     ",
    " ....",
    ".   .",
    ".   .",
    ".  ..",
    " .. .",
    "    .",
    "    .",
  ],
  "r": [
    "     ",
    "     ",
    ". .. ",
    "..  .",
    ".    ",
    ".    ",
    ".    ",
    "     ",
    "     ",
  ],
  "s": [
    "     ",
    "     ",
    " ....",
    ".    ",
    " ... ",
    "    .",
    ".... ",
    "     ",
    "     ",
  ],
  "t": [
    " .   ",
    " .   ",
    ".... ",
    " .   ",
    " .   ",
    " .  .",
    "  .. ",
    "     ",
    "     ",
  ],
  "u": [
    "     ",
    "     ",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    " ....",
    "     ",
    "     ",
  ],
  "v": [
    "     ",
    "     ",
    ".   .",
    ".   .",
    " . . ",
    " . . ",
    "  .  ",
    "     ",
    "     ",
  ],
  "w": [
    "     ",
    "     ",
    ". . .",
    ". . .",
    ". . .",
    ". . .",
    " ....",
    "     ",
    "     ",
  ],
  "x": [
    "     ",
    "     ",
    ".   .",
    " . . ",
    "  .  ",
    " . . ",
    ".   .",
    "     ",
    "     ",
  ],
  "y": [
    "     ",
    "     ",
    ".   .",
    ".   .",
    ".   .",
    ".   .",
    " ....",
    "    .",
    ".... ",
  ],
  "z": [
    "     ",
    "     ",
    ".....",
    "   . ",
    "  .  ",
    " .   ",
    ".....",
    "     ",
    "     ",
  ],
  "{": [
    " ..",
    " . ",
    " . ",
    ".  ",
    " . ",
    " . ",
    " ..",
    "   ",
    "   ",
  ],
  "|": [
    ".",
    ".",
    ".",
    ".",
    ".",
    ".",
    ".",
    " ",
    " ",
  ],
  "}": [
    ".. ",
    " . ",
    " . ",
    "  .",
    " . ",
    " . ",
    ".. ",
    "   ",
    "   ",
  ],
  "~": [
    "     ",
    "     ",
    " .. .",
    ". .. ",
    "     ",
    "     ",
    "     ",
    "     ",
    "     ",
  ],
}

from fontTools.fontBuilder import FontBuilder
from fontTools.pens.ttGlyphPen import TTGlyphPen
from fontTools.misc.transform import Transform
import time

def get_char_width(pattern):
  max_width = 0
  for row in pattern:
    for i in range(len(row)-1, -1, -1):
      if row[i] == '.':
        max_width = max(max_width, i+1)
        break
  return (max_width if max_width > 0 else 1) + 1

def convert_pattern_to_coordinates(pattern):
  coordinates = []
  for y, row in enumerate(pattern):
    for x, char in enumerate(row):
      if char == '.':
        coordinates.append((x * 100, (7 - y) * 100))
  return coordinates

def create_bitmap_font():
  fb = FontBuilder(1000, isTTF=True)
  
  font_name = "sqfont"
  fb.setupNameTable({
    "familyName": font_name,
    "styleName": "Regular",
    "uniqueFontIdentifier": f"{font_name}:Version 1.0",
    "fullName": f"{font_name} Regular",
    "version": "Version 1.0",
    "psName": font_name,
    "manufacturer": "SquareScreamYT",
    "designer": "SquareScreamYT",
    "description": "A pixel font created by SquareScreamYT",
    "vendorURL": "https://sq.is-a.dev",
    "designerURL": "https://sq.is-a.dev",
    "license": "CC BY-ND 4.0",
    "licenseURL": "https://creativecommons.org/licenses/by-nd/4.0/",
    "copyright": "Copyright (c) 2024 SquareScreamYT",
  })
    
  current_time = int(time.time())
  fb.setupHead(
    created=current_time,
    modified=current_time,
    flags=0x000B,
    unitsPerEm=1000,
    xMin=0,
    yMin=-200,
    xMax=500,
    yMax=900
  )

  fb.setupGlyphOrder(list(char_dict.keys()))
  fb.setupCharacterMap({ord(char): char for char in char_dict.keys()})
  
  pen = TTGlyphPen(None)
  glyphs = {}
  
  for char, pattern in char_dict.items():
    dots = convert_pattern_to_coordinates(pattern)
    for x, y in dots:
      pen.moveTo((x, y))
      pen.lineTo((x + 100, y))
      pen.lineTo((x + 100, y + 100))
      pen.lineTo((x, y + 100))
      pen.closePath()
    
    glyphs[char] = pen.glyph()
    pen = TTGlyphPen(None)
  
  fb.setupGlyf(glyphs)
  fb.setupHorizontalMetrics({gname: (get_char_width(pattern) * 100, 25) for gname, pattern in char_dict.items()})
  
  fb.setupHorizontalHeader(
    ascent=900,
    descent=-200,
    lineGap=100
  )
  
  fb.setupOS2(
    sTypoAscender=900,
    sTypoDescender=-200,
    sTypoLineGap=100,
    usWinAscent=900,
    usWinDescent=200,
    fsSelection=0x40,
    sxHeight=500,
    sCapHeight=900
  )
  
  fb.setupPost()
  fb.save("bitmap_font.ttf")

create_bitmap_font()
